# Установка сервера 1С (с web публикацией)
## Установка web-сервера apache
Установка производится из репозитория ubuntu с помощью пакетного менеджера **apt**

```bash
sudo apt install apache2
```
По завершении установки процесс запущен со стандартными настройками и добавлен а автозагрузку

## Установка серевера 1С версии 8.3.20.1647
На сервере выполняем обновление данных о пакетах репозитория
```bash
sudo apt update
```
Устанавливаем необходимые для работы 1С компоненты (шрифты, библиотеки)
```bash
sudo apt install ttf-mscorefonts-installer libodbc1
```
Предварительно скаченный дистрибутив передаем на сервер в домашний каталог пользователя, под которым выполняем подключение через ssh (команда выполняется на машине, где находится дистрибутив)
```cmd
scp server64_8_3_20_1674.tar [username]@[servername]:/home/[homedir]
```
Распаковываем файлы архива в текущий каталог
```bash
tar -xzf server64_8_3_20_1674.tar.gz
```
Запускаем установщик 1С Предприятия. Указываем компоненты: кластер серверов, модули расширения веб-сервера
```bash
./setup-full-8.3.20.1674-x86_64.run --mode unattended --enable-components server,ws
```
Копируем скрипт запуска **srv1cv83** из каталога **/opt/1cv8/x86_64/8.3.20.1674/** в файл **/etc/init.d**
```bash
sudo cp /opt/1cv8/x86_64/8.3.20.1674/srv1cv83 /etc/init.d/
```
Копируем конфигурационный файл сервера 1с **srv1cv83.conf** из каталога **opt/1cv8/x86_64/8.3.20.1674/** в каталог **/etc/default/srv1cv83** (в файл без расширения .conf)
```bash
sudo cp /opt/1cv8/x86_64/8.3.20.1674/srv1cv83.conf /etc/default/srv1cv83
```
Добавляем в автозагрузку скопированный скрипт
```bash
sudo update-rc.d srv1cv83 defaults
```
Запускаем сервер 1С Предпрятия
```bash
sudo systemctl start srv1cv83
```
### Дополнительно
В текущем релизие имеется проблема: при установке сервера 1С устанваливаются элементы графической оболочки, котороые в дальнейшем не нужны.
Удалим их.
```bash
sudo apt purge gnome-shell gnome-control-center gnome-keyring
sudo apt autoremove
```
## Установка СУБД PostgreSQL Pro v.14
Установка совершается из репозитория **Postgres Professional**. Предварительно репозиторий доавбляется в список доступных репоизториев сервера с помощью скаченного скрипта
Скачиваем скрипт добавления репозитория для версии PostgresPro Standard 14 (https://repo.postgrespro.ru/pgpro-14/keys/apt-repo-add.sh)
```bash
curl -o apt-repo-add.sh https://repo.postgrespro.ru/pgpro-14/keys/apt-repo-add.sh
```
Запускаем скачанный скрипт с помощью оболочки sh
```bash
sudo sh apt-repo-add.sh
```
Установливаем **PostgresPro Standard 14** с помощью пакетного менеджера **apt**
```bash
sudo apt install postgrespro-std-14
```
### Первоначальная настройка Postgres Pro 14
Для возможности создания базы данных 1С Предприятия после установки Postgres Pro необходимо выполнить минимальные настройки, связанные с доступом.

Для возможности подключения к СУБД с других машин необходимо в файле `postgresql.conf` из каталога `/var/lib/pgpro/std-14/data/` прописать параметры подключения
>Здесь и далее примеры редактирования файлов приводятся с использованием тектового редактора **nano**
```bash
sudo nano /var/lib/pgpro/std-14/data/postgresql.conf
```
Найти строку с параметрами подключения
```bash
#listen_addresses = 'localhost'
```

РАскомментироват и заменить **localhost** на адрес машиныы, с которой осуществляется подключение (или \* для подключения с любого адреса)

![image](https://user-images.githubusercontent.com/36333345/147487973-5b51258d-1cff-4c15-9afc-4772f4a100cc.png)




